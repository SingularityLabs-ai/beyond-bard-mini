"use strict";(()=>{var qt=Object.create;var Ne=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var Gt=Object.getOwnPropertyNames;var Ht=Object.getPrototypeOf,Vt=Object.prototype.hasOwnProperty;var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Jt=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Gt(t))!Vt.call(e,a)&&a!==r&&Ne(e,a,{get:()=>t[a],enumerable:!(o=Wt(t,a))||o.enumerable});return e};var G=(e,t,r)=>(r=e!=null?qt(Ht(e)):{},Jt(t||!e||!e.__esModule?Ne(r,"default",{value:e,enumerable:!0}):r,e));var z=K((ge,Be)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof ge<"u")t(Be);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ge,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=o=>{let a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(f,p=void 0){super(p),this.createItem=f}get(f){return this.has(f)||this.set(f,this.createItem(f)),super.get(f)}}let i=n=>n&&typeof n=="object"&&typeof n.then=="function",m=(n,f)=>(...p)=>{o.runtime.lastError?n.reject(new Error(o.runtime.lastError.message)):f.singleCallbackArg||p.length<=1&&f.singleCallbackArg!==!1?n.resolve(p[0]):n.resolve(p)},l=n=>n==1?"argument":"arguments",s=(n,f)=>function(g,...v){if(v.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${l(f.minArgs)} for ${n}(), got ${v.length}`);if(v.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${l(f.maxArgs)} for ${n}(), got ${v.length}`);return new Promise((P,R)=>{if(f.fallbackToNoCallback)try{g[n](...v,m({resolve:P,reject:R},f))}catch{g[n](...v),f.fallbackToNoCallback=!1,f.noCallback=!0,P()}else f.noCallback?(g[n](...v),P()):g[n](...v,m({resolve:P,reject:R},f))})},h=(n,f,p)=>new Proxy(f,{apply(g,v,P){return p.call(v,n,...P)}}),b=Function.call.bind(Object.prototype.hasOwnProperty),y=(n,f={},p={})=>{let g=Object.create(null),v={has(R,c){return c in n||c in g},get(R,c,j){if(c in g)return g[c];if(!(c in n))return;let w=n[c];if(typeof w=="function")if(typeof f[c]=="function")w=h(n,n[c],f[c]);else if(b(p,c)){let F=s(c,p[c]);w=h(n,n[c],F)}else w=w.bind(n);else if(typeof w=="object"&&w!==null&&(b(f,c)||b(p,c)))w=y(w,f[c],p[c]);else if(b(p,"*"))w=y(w,f[c],p["*"]);else return Object.defineProperty(g,c,{configurable:!0,enumerable:!0,get(){return n[c]},set(F){n[c]=F}}),w;return g[c]=w,w},set(R,c,j,w){return c in g?g[c]=j:n[c]=j,!0},defineProperty(R,c,j){return Reflect.defineProperty(g,c,j)},deleteProperty(R,c){return Reflect.deleteProperty(g,c)}},P=Object.create(n);return new Proxy(P,v)},d=n=>({addListener(f,p,...g){f.addListener(n.get(p),...g)},hasListener(f,p){return f.hasListener(n.get(p))},removeListener(f,p){f.removeListener(n.get(p))}}),I=new u(n=>typeof n!="function"?n:function(p){let g=y(p,{},{getContent:{minArgs:0,maxArgs:0}});n(g)}),C=new u(n=>typeof n!="function"?n:function(p,g,v){let P=!1,R,c=new Promise(W=>{R=function(M){P=!0,W(M)}}),j;try{j=n(p,g,R)}catch(W){j=Promise.reject(W)}let w=j!==!0&&i(j);if(j!==!0&&!w&&!P)return!1;let F=W=>{W.then(M=>{v(M)},M=>{let de;M&&(M instanceof Error||typeof M.message=="string")?de=M.message:de="An unexpected error occurred",v({__mozWebExtensionPolyfillReject__:!0,message:de})}).catch(M=>{})};return F(w?j:c),!0}),O=({reject:n,resolve:f},p)=>{o.runtime.lastError?o.runtime.lastError.message===t?f():n(new Error(o.runtime.lastError.message)):p&&p.__mozWebExtensionPolyfillReject__?n(new Error(p.message)):f(p)},S=(n,f,p,...g)=>{if(g.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${l(f.minArgs)} for ${n}(), got ${g.length}`);if(g.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${l(f.maxArgs)} for ${n}(), got ${g.length}`);return new Promise((v,P)=>{let R=O.bind(null,{resolve:v,reject:P});g.push(R),p.sendMessage(...g)})},k={devtools:{network:{onRequestFinished:d(I)}},runtime:{onMessage:d(C),onMessageExternal:d(C),sendMessage:S.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:S.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},q={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":q},services:{"*":q},websites:{"*":q}},y(o,k,a)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var ht=K((jn,xt)=>{"use strict";xt.exports=()=>{let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}});var yt=K((On,At)=>{"use strict";var $o=ht();function qo(e,t="maxAge"){let r,o,a,u=async()=>{if(r!==void 0)return;let l=async s=>{a=$o();let h=s[1][t]-Date.now();if(h<=0){e.delete(s[0]),a.resolve();return}return r=s[0],o=setTimeout(()=>{e.delete(s[0]),a&&a.resolve()},h),typeof o.unref=="function"&&o.unref(),a.promise};try{for(let s of e)await l(s)}catch{}r=void 0},i=()=>{r=void 0,o!==void 0&&(clearTimeout(o),o=void 0),a!==void 0&&(a.reject(void 0),a=void 0)},m=e.set.bind(e);return e.set=(l,s)=>{e.has(l)&&e.delete(l);let h=m(l,s);return r&&r===l&&i(),u(),h},u(),e}At.exports=qo});var ve=K((kn,bt)=>{"use strict";var Wo=yt(),we=class{constructor(t,r){if(this.maxAge=t,this[Symbol.toStringTag]="Map",this.data=new Map,Wo(this.data),r)for(let[o,a]of r)this.set(o,a)}get size(){return this.data.size}clear(){this.data.clear()}delete(t){return this.data.delete(t)}has(t){return this.data.has(t)}get(t){let r=this.data.get(t);if(r)return r.data}set(t,r){return this.data.set(t,{maxAge:Date.now()+this.maxAge,data:r}),this}values(){return this.createIterator(t=>t[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(t=>[t[0],t[1].data])}forEach(t,r){for(let[o,a]of this.entries())t.apply(r,[a,o,this])}[Symbol.iterator](){return this.entries()}*createIterator(t){for(let r of this.data.entries())yield t(r)}};bt.exports=we});var A=G(z());var Kt=typeof global=="object"&&global&&global.Object===Object&&global,Q=Kt;var zt=typeof self=="object"&&self&&self.Object===Object&&self,Qt=Q||zt||Function("return this")(),E=Qt;var Yt=E.Symbol,D=Yt;var Le=Object.prototype,Zt=Le.hasOwnProperty,Xt=Le.toString,H=D?D.toStringTag:void 0;function er(e){var t=Zt.call(e,H),r=e[H];try{e[H]=void 0;var o=!0}catch{}var a=Xt.call(e);return o&&(t?e[H]=r:delete e[H]),a}var Ue=er;var tr=Object.prototype,rr=tr.toString;function or(e){return rr.call(e)}var Fe=or;var sr="[object Null]",ar="[object Undefined]",De=D?D.toStringTag:void 0;function nr(e){return e==null?e===void 0?ar:sr:De&&De in Object(e)?Ue(e):Fe(e)}var N=nr;function ir(e){return e!=null&&typeof e=="object"}var $=ir;var fr=Array.isArray,$e=fr;function ur(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Y=ur;var lr="[object AsyncFunction]",cr="[object Function]",mr="[object GeneratorFunction]",pr="[object Proxy]";function dr(e){if(!Y(e))return!1;var t=N(e);return t==cr||t==mr||t==lr||t==pr}var Z=dr;var gr=E["__core-js_shared__"],X=gr;var qe=function(){var e=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function xr(e){return!!qe&&qe in e}var We=xr;var hr=Function.prototype,Ar=hr.toString;function yr(e){if(e!=null){try{return Ar.call(e)}catch{}try{return e+""}catch{}}return""}var B=yr;var br=/[\\^$.*+?()[\]{}|]/g,wr=/^\[object .+?Constructor\]$/,vr=Function.prototype,Tr=Object.prototype,Er=vr.toString,Sr=Tr.hasOwnProperty,Pr=RegExp("^"+Er.call(Sr).replace(br,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Cr(e){if(!Y(e)||We(e))return!1;var t=Z(e)?Pr:wr;return t.test(B(e))}var Ge=Cr;function Rr(e,t){return e?.[t]}var He=Rr;function jr(e,t){var r=He(e,t);return Ge(r)?r:void 0}var _=jr;var Or=_(E,"WeakMap"),ee=Or;var kr=9007199254740991;function Ir(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=kr}var te=Ir;function _r(e){return e!=null&&te(e.length)&&!Z(e)}var Ve=_r;var Mr=Object.prototype;function Nr(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Mr;return e===r}var re=Nr;var Br="[object Arguments]";function Lr(e){return $(e)&&N(e)==Br}var xe=Lr;var Je=Object.prototype,Ur=Je.hasOwnProperty,Fr=Je.propertyIsEnumerable,Dr=xe(function(){return arguments}())?xe:function(e){return $(e)&&Ur.call(e,"callee")&&!Fr.call(e,"callee")},Ke=Dr;function $r(){return!1}var ze=$r;var Ze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Qe=Ze&&typeof module=="object"&&module&&!module.nodeType&&module,qr=Qe&&Qe.exports===Ze,Ye=qr?E.Buffer:void 0,Wr=Ye?Ye.isBuffer:void 0,Gr=Wr||ze,Xe=Gr;var Hr="[object Arguments]",Vr="[object Array]",Jr="[object Boolean]",Kr="[object Date]",zr="[object Error]",Qr="[object Function]",Yr="[object Map]",Zr="[object Number]",Xr="[object Object]",eo="[object RegExp]",to="[object Set]",ro="[object String]",oo="[object WeakMap]",so="[object ArrayBuffer]",ao="[object DataView]",no="[object Float32Array]",io="[object Float64Array]",fo="[object Int8Array]",uo="[object Int16Array]",lo="[object Int32Array]",co="[object Uint8Array]",mo="[object Uint8ClampedArray]",po="[object Uint16Array]",go="[object Uint32Array]",x={};x[no]=x[io]=x[fo]=x[uo]=x[lo]=x[co]=x[mo]=x[po]=x[go]=!0;x[Hr]=x[Vr]=x[so]=x[Jr]=x[ao]=x[Kr]=x[zr]=x[Qr]=x[Yr]=x[Zr]=x[Xr]=x[eo]=x[to]=x[ro]=x[oo]=!1;function xo(e){return $(e)&&te(e.length)&&!!x[N(e)]}var et=xo;function ho(e){return function(t){return e(t)}}var tt=ho;var rt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,V=rt&&typeof module=="object"&&module&&!module.nodeType&&module,Ao=V&&V.exports===rt,he=Ao&&Q.process,yo=function(){try{var e=V&&V.require&&V.require("util").types;return e||he&&he.binding&&he.binding("util")}catch{}}(),Ae=yo;var ot=Ae&&Ae.isTypedArray,bo=ot?tt(ot):et,st=bo;function wo(e,t){return function(r){return e(t(r))}}var at=wo;var vo=at(Object.keys,Object),nt=vo;var To=Object.prototype,Eo=To.hasOwnProperty;function So(e){if(!re(e))return nt(e);var t=[];for(var r in Object(e))Eo.call(e,r)&&r!="constructor"&&t.push(r);return t}var it=So;var Po=_(E,"Map"),oe=Po;var Co=_(E,"DataView"),se=Co;var Ro=_(E,"Promise"),ae=Ro;var jo=_(E,"Set"),ne=jo;var ft="[object Map]",Oo="[object Object]",ut="[object Promise]",lt="[object Set]",ct="[object WeakMap]",mt="[object DataView]",ko=B(se),Io=B(oe),_o=B(ae),Mo=B(ne),No=B(ee),U=N;(se&&U(new se(new ArrayBuffer(1)))!=mt||oe&&U(new oe)!=ft||ae&&U(ae.resolve())!=ut||ne&&U(new ne)!=lt||ee&&U(new ee)!=ct)&&(U=function(e){var t=N(e),r=t==Oo?e.constructor:void 0,o=r?B(r):"";if(o)switch(o){case ko:return mt;case Io:return ft;case _o:return ut;case Mo:return lt;case No:return ct}return t});var pt=U;var Bo="[object Map]",Lo="[object Set]",Uo=Object.prototype,Fo=Uo.hasOwnProperty;function Do(e){if(e==null)return!0;if(Ve(e)&&($e(e)||typeof e=="string"||typeof e.splice=="function"||Xe(e)||st(e)||Ke(e)))return!e.length;var t=pt(e);if(t==Bo||t==Lo)return!e.size;if(re(e))return!it(e).length;for(var r in e)if(Fo.call(e,r))return!1;return!0}var ye=Do;var be=G(z());async function J(){let{provider:e="bard"}=await be.default.storage.local.get("provider"),t=`provider:${"bard"}`,r=await be.default.storage.local.get(t);return{provider:e,configs:{["bard"]:r[t]}}}var L="https://bard.google.com";var dt="gpt-3.5-turbo",gt="api.openai.com";var kt=G(ve());var Go=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ho=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Vo=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function Jo(e,t){if(e!=="__proto__"&&!(e==="constructor"&&t&&typeof t=="object"&&"prototype"in t))return t}function wt(e,t={}){if(typeof e!="string")return e;let r=e.toLowerCase().trim();if(r==="true")return!0;if(r==="false")return!1;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r!=="undefined"){if(!Vo.test(e)){if(t.strict)throw new SyntaxError("Invalid JSON");return e}try{return Go.test(e)||Ho.test(e)?JSON.parse(e,Jo):JSON.parse(e)}catch(o){if(t.strict)throw o;return e}}}var _n=String.fromCharCode;var Ko=/#/g,zo=/&/g;var Qo=/=/g;var Tt=/\+/g,Yo=/%5e/gi,Zo=/%60/gi;var Xo=/%7c/gi;var es=/%20/gi;function ts(e){return encodeURI(""+e).replace(Xo,"|")}function Ee(e){return ts(typeof e=="string"?e:JSON.stringify(e)).replace(Tt,"%2B").replace(es,"+").replace(Ko,"%23").replace(zo,"%26").replace(Zo,"`").replace(Yo,"^")}function Te(e){return Ee(e).replace(Qo,"%3D")}function Et(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function rs(e){return Et(e.replace(Tt," "))}function os(e=""){let t={};e[0]==="?"&&(e=e.slice(1));for(let r of e.split("&")){let o=r.match(/([^=]+)=?(.*)/)||[];if(o.length<2)continue;let a=Et(o[1]);if(a==="__proto__"||a==="constructor")continue;let u=rs(o[2]||"");typeof t[a]<"u"?Array.isArray(t[a])?t[a].push(u):t[a]=[t[a],u]:t[a]=u}return t}function ss(e,t){return(typeof t=="number"||typeof t=="boolean")&&(t=String(t)),t?Array.isArray(t)?t.map(r=>`${Te(e)}=${Ee(r)}`).join("&"):`${Te(e)}=${Ee(t)}`:Te(e)}function as(e){return Object.keys(e).filter(t=>e[t]!==void 0).map(t=>ss(t,e[t])).join("&")}var ns=/^\w{2,}:([/\\]{1,2})/,is=/^\w{2,}:([/\\]{2})?/,fs=/^([/\\]\s*){2,}[^/\\]/;function St(e,t={}){return typeof t=="boolean"&&(t={acceptRelative:t}),t.strict?ns.test(e):is.test(e)||(t.acceptRelative?fs.test(e):!1)}var us=/\/$|\/\?/;function Se(e="",t=!1){return t?us.test(e):e.endsWith("/")}function ls(e="",t=!1){if(!t)return(Se(e)?e.slice(0,-1):e)||"/";if(!Se(e,!0))return e||"/";let[r,...o]=e.split("?");return(r.slice(0,-1)||"/")+(o.length>0?`?${o.join("?")}`:"")}function cs(e="",t=!1){if(!t)return e.endsWith("/")?e:e+"/";if(Se(e,!0))return e||"/";let[r,...o]=e.split("?");return r+"/"+(o.length>0?`?${o.join("?")}`:"")}function ms(e=""){return e.startsWith("/")}function ps(e=""){return(ms(e)?e.slice(1):e)||"/"}function Pt(e,t){if(ds(t)||St(e))return e;let r=ls(t);return e.startsWith(r)?e:xs(r,e)}function Ct(e,t){let r=Rt(e),o={...os(r.search),...t};return r.search=as(o),hs(r)}function ds(e){return!e||e==="/"}function gs(e){return e&&e!=="/"}function xs(e,...t){let r=e||"";for(let o of t.filter(a=>gs(a)))r=r?cs(r)+ps(o):o;return r}function Rt(e="",t){if(!St(e,{acceptRelative:!0}))return t?Rt(t+e):vt(e);let[r="",o,a=""]=(e.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[u="",i=""]=(a.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:m,search:l,hash:s}=vt(i.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r,auth:o?o.slice(0,Math.max(0,o.length-1)):"",host:u,pathname:m,search:l,hash:s}}function vt(e=""){let[t="",r="",o=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:r,hash:o}}function hs(e){let t=e.pathname+(e.search?(e.search.startsWith("?")?"":"?")+e.search:"")+e.hash;return e.protocol?e.protocol+"//"+(e.auth?e.auth+"@":"")+e.host+t:t}var Pe=class extends Error{constructor(){super(...arguments),this.name="FetchError"}};function As(e,t,r){let o="";t&&(o=t.message),e&&r?o=`${o} (${r.status} ${r.statusText} (${e.toString()}))`:e&&(o=`${o} (${e.toString()})`);let a=new Pe(o);return Object.defineProperty(a,"request",{get(){return e}}),Object.defineProperty(a,"response",{get(){return r}}),Object.defineProperty(a,"data",{get(){return r&&r._data}}),Object.defineProperty(a,"status",{get(){return r&&r.status}}),Object.defineProperty(a,"statusText",{get(){return r&&r.statusText}}),Object.defineProperty(a,"statusCode",{get(){return r&&r.status}}),Object.defineProperty(a,"statusMessage",{get(){return r&&r.statusText}}),a}var ys=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function jt(e="GET"){return ys.has(e.toUpperCase())}function bs(e){if(e===void 0)return!1;let t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}var ws=new Set(["image/svg","application/xml","application/xhtml","application/html"]),vs=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Ts(e=""){if(!e)return"json";let t=e.split(";").shift()||"";return vs.test(t)?"json":ws.has(t)||t.startsWith("text/")?"text":"blob"}var Es=new Set([408,409,425,429,500,502,503,504]);function Ce(e){let{fetch:t,Headers:r}=e;function o(i){let m=i.error&&i.error.name==="AbortError"||!1;if(i.options.retry!==!1&&!m){let s;typeof i.options.retry=="number"?s=i.options.retry:s=jt(i.options.method)?0:1;let h=i.response&&i.response.status||500;if(s>0&&Es.has(h))return a(i.request,{...i.options,retry:s-1})}let l=As(i.request,i.error,i.response);throw Error.captureStackTrace&&Error.captureStackTrace(l,a),l}let a=async function(m,l={}){let s={request:m,options:{...e.defaults,...l},response:void 0,error:void 0};s.options.onRequest&&await s.options.onRequest(s),typeof s.request=="string"&&(s.options.baseURL&&(s.request=Pt(s.request,s.options.baseURL)),(s.options.query||s.options.params)&&(s.request=Ct(s.request,{...s.options.params,...s.options.query})),s.options.body&&jt(s.options.method)&&bs(s.options.body)&&(s.options.body=typeof s.options.body=="string"?s.options.body:JSON.stringify(s.options.body),s.options.headers=new r(s.options.headers),s.options.headers.has("content-type")||s.options.headers.set("content-type","application/json"),s.options.headers.has("accept")||s.options.headers.set("accept","application/json"))),s.response=await t(s.request,s.options).catch(async b=>(s.error=b,s.options.onRequestError&&await s.options.onRequestError(s),o(s)));let h=(s.options.parseResponse?"json":s.options.responseType)||Ts(s.response.headers.get("content-type")||"");if(h==="json"){let b=await s.response.text(),y=s.options.parseResponse||wt;s.response._data=y(b)}else h==="stream"?s.response._data=s.response.body:s.response._data=await s.response[h]();return s.options.onResponse&&await s.options.onResponse(s),s.response.status>=400&&s.response.status<600?(s.options.onResponseError&&await s.options.onResponseError(s),o(s)):s.response},u=function(m,l){return a(m,l).then(s=>s._data)};return u.raw=a,u.native=t,u.create=(i={})=>Ce({...e,defaults:{...e.defaults,...i}}),u}var Ot=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),Ss=Ot.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),Ps=Ot.Headers,Re=Ce({fetch:Ss,Headers:Ps});async function It(e){}async function Cs(e,t,r){}var qn=new kt.default(10*1e3);var ie=class{constructor(t){this.token=t;this.token=t}extractFromHTML(t,r){let a=new RegExp(`"${t}":"([^"]+)"`).exec(r);return a==null?void 0:a[1]}async fetchRequestParams(){let t=await Re("https://bard.google.com/faq"),r=this.extractFromHTML("SNlM0e",t),o=this.extractFromHTML("cfb2h",t);return{atValue:r,blValue:o}}async parseBartResponse(t){let r=JSON.parse(t.split(`
`)[3]),o=JSON.parse(r[0][2]);if(!o)throw new ChatError("Failed to access Bard",ErrorCode.BARD_EMPTY_RESPONSE);return{text:o[0][0],ids:[...o[1],o[4][0][0]]}}async generateReqId(){return Math.floor(Math.random()*9e5)+1e5}async generateAnswer(t){let r,o=()=>{r&&Cs(this.token,r,{is_visible:!1})};this.conversationContext=t.conversationContext,this.conversationContext||(this.conversationContext={requestParams:await this.fetchRequestParams(),contextIds:["","",""]});let{requestParams:a,contextIds:u}=this.conversationContext,i=await Re("https://bard.google.com/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",signal:t.signal,query:{bl:a.blValue,_reqid:this.generateReqId(),rt:"c"},body:new URLSearchParams({at:a.atValue,"f.req":JSON.stringify([null,`[[${JSON.stringify(t.prompt)}],null,${JSON.stringify(u)}]`])}),parseResponse:s=>s}),{text:m,ids:l}=await this.parseBartResponse(i);return this.conversationContext.contextIds=l,m&&(r="dataconversation_id",t.onEvent({type:"answer",data:{text:m,conversationContext:this.conversationContext}})),t.onEvent({type:"done"}),o(),{cleanup:o}}resetConversation(){this.conversationContext=void 0}};var Lt=G(ve());var fe,Rs=new Uint8Array(16);function je(){if(!fe&&(fe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fe(Rs)}var T=[];for(let e=0;e<256;++e)T.push((e+256).toString(16).slice(1));function _t(e,t=0){return(T[e[t+0]]+T[e[t+1]]+T[e[t+2]]+T[e[t+3]]+"-"+T[e[t+4]]+T[e[t+5]]+"-"+T[e[t+6]]+T[e[t+7]]+"-"+T[e[t+8]]+T[e[t+9]]+"-"+T[e[t+10]]+T[e[t+11]]+T[e[t+12]]+T[e[t+13]]+T[e[t+14]]+T[e[t+15]]).toLowerCase()}var js=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Oe={randomUUID:js};function Os(e,t,r){if(Oe.randomUUID&&!t&&!e)return Oe.randomUUID();e=e||{};let o=e.random||(e.rng||je)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){r=r||0;for(let a=0;a<16;++a)t[r+a]=o[a];return t}return _t(o)}var ue=Os;function Mt(e){let t,r,o,a,u,i,m;return l(),{feed:s,reset:l};function l(){t=!0,r="",o=0,a=-1,u=void 0,i=void 0,m=""}function s(b){r=r?r+b:b,t&&ks(r)&&(r=r.slice(Nt.length)),t=!1;let y=r.length,d=0,I=!1;for(;d<y;){I&&(r[d]===`
`&&++d,I=!1);let C=-1,O=a,S;for(let k=o;C<0&&k<y;++k)S=r[k],S===":"&&O<0?O=k-d:S==="\r"?(I=!0,C=k-d):S===`
`&&(C=k-d);if(C<0){o=y-d,a=O;break}else o=0,a=-1;h(r,d,O,C),d+=C+1}d===y?r="":d>0&&(r=r.slice(d))}function h(b,y,d,I){if(I===0){m.length>0&&(e({type:"event",id:u,event:i||void 0,data:m.slice(0,-1)}),m="",u=void 0),i=void 0;return}let C=d<0,O=b.slice(y,y+(C?I:d)),S=0;C?S=I:b[y+d+1]===" "?S=d+2:S=d+1;let k=y+S,q=I-S,n=b.slice(k,k+q).toString();if(O==="data")m+=n?"".concat(n,`
`):`
`;else if(O==="event")i=n;else if(O==="id"&&!n.includes("\0"))u=n;else if(O==="retry"){let f=parseInt(n,10);Number.isNaN(f)||e({type:"reconnect-interval",value:f})}}}var Nt=[239,187,191];function ks(e){return Nt.every((t,r)=>e.charCodeAt(r)===t)}async function*Bt(e){let t=e.getReader();try{for(;;){let{done:r,value:o}=await t.read();if(r)return;yield o}}finally{t.releaseLock()}}async function le(e,t){let{onMessage:r,...o}=t,a=await fetch(e,o);if(!a.ok){let i=await a.json().catch(()=>({}));throw new Error(ye(i)?`${a.status} ${a.statusText}`:JSON.stringify(i))}let u=Mt(i=>{i.type==="event"&&r(i.data)});for await(let i of Bt(a.body)){let m=new TextDecoder().decode(i);u.feed(m)}}async function _e(e,t,r,o){return fetch(`${L}/backend-api${r}`,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:o===void 0?void 0:JSON.stringify(o)})}async function Ut(e,t){await _e(e,"POST","/conversation/message_feedback",t)}async function Is(e,t,r){await _e(e,"PATCH",`/conversation/${t}`,r)}var ke="accessToken",Ie=new Lt.default(10*1e3);async function me(){if(Ie.get(ke))return Ie.get(ke);let e=await fetch(`${L}/api/auth/session`);if(e.status===403)throw new Error("CLOUDFLARE");let t=await e.json().catch(()=>({}));if(!t.accessToken)throw new Error("UNAUTHORIZED");return Ie.set(ke,t.accessToken),t.accessToken}var ce=class{constructor(t){this.token=t;this.token=t}async fetchModels(){return(await _e(this.token,"GET","/models").then(r=>r.json())).models}async getModelName(){try{return(await this.fetchModels())[0].slug}catch(t){return"text-davinci-002-render-sha"}}async generateAnswer(t){let r,o=()=>{r&&Is(this.token,r,{is_visible:!0})},a=await this.getModelName();return await le(`${L}/backend-api/conversation`,{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({action:"next",messages:[{id:ue(),role:"user",content:{content_type:"text",parts:[t.prompt]}}],model:a,parent_message_id:ue()}),onMessage(u){var l,s,h;if(u==="[DONE]"){t.onEvent({type:"done"}),o();return}let i;try{i=JSON.parse(u)}catch(b){return}let m=(h=(s=(l=i.message)==null?void 0:l.content)==null?void 0:s.parts)==null?void 0:h[0];m&&(r=i.conversation_id,t.onEvent({type:"answer",data:{text:m,messageId:i.message.id,conversationId:i.conversation_id}}))}}),{cleanup:o}}};var pe=class{constructor(t,r){this.token=t;this.model=r;this.token=t,this.model=r}buildPrompt(t){return this.model.startsWith("text-chat-davinci")?`Respond conversationally.<|im_end|>

User: ${t}<|im_sep|>
ChatGPT:`:t}buildMessages(t){return[{role:"user",content:t}]}async generateAnswer(t){var l,s,h;let[r]=await Promise.all([J()]),o=(s=(l=r.configs["gpt3"])==null?void 0:l.model)!=null?s:dt,a=((h=r.configs["gpt3"])==null?void 0:h.apiHost)||gt,u="",i={model:this.model,stream:!0,max_tokens:800};o==="text-davinci-003"?(u=`https://${a}/v1/completions`,i={...i,prompt:this.buildPrompt(t.prompt)}):(u=`https://${a}/v1/chat/completions`,i={...i,messages:this.buildMessages(t.prompt)});let m="";return await le(u,{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(i),onMessage(b){if(b==="[DONE]"){t.onEvent({type:"done"});return}let y;try{y=JSON.parse(b);let d=o==="text-davinci-003"?y.choices[0].text:y.choices[0].delta.content;if(d===void 0||d==="<|im_end|>"||d==="<|im_sep|>")return;m+=d,t.onEvent({type:"answer",data:{text:m,messageId:y.id,conversationId:y.id}})}catch(d){return}}}),{}}};var Me=G(z());var di=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Ft=navigator.userAgent.indexOf("Firefox")!=-1,gi=/iPad|iPhone|iPod/.test(navigator.userAgent);function Dt(e){let{id:t,url:r}=e;r.includes(`${L}/chat`)?Me.default.tabs.sendMessage(t,{type:"CHATGPT_TAB_CURRENT",data:{isLogin:!0}}).catch(()=>{}):Me.default.tabs.sendMessage(t,{type:"CHATGPT_TAB_CURRENT",data:{isLogin:!1}}).catch(()=>{})}async function Ms(e,t,r,o,a){let u=await J(),i;if(u.provider==="bard")i=new ie;else if(u.provider==="chatgpt"){let s=await me();i=new ce(s)}else if(u.provider==="gpt3"){let{apiKey:s,model:h}=u.configs["gpt3"];i=new pe(s,h)}else throw new Error(`Unknown provider ${u.provider}`);let m=new AbortController;e.onDisconnect.addListener(()=>{m.abort(),l==null||l()});let{cleanup:l}=await i.generateAnswer({prompt:t,signal:m.signal,onEvent(s){if(s.type==="done"){e.postMessage({event:"DONE"});return}e.postMessage(s.data)},conversationId:r,parentMessageId:o,conversationContext:a})}async function Ns(e){A.default.tabs.query({currentWindow:!0,active:!0}).then(o=>{let a=o[0];a.id&&A.default.storage.local.set({beyondbardTabId:a.id})});let t=await A.default.storage.local.get("pinnedTabId"),r;if(t.pinnedTabId)try{r=await A.default.tabs.get(t.pinnedTabId),A.default.tabs.update(r.id,{active:!0,pinned:!0})}catch(o){}return r||(r=await A.default.tabs.create({url:e,pinned:!0,active:!0})),A.default.storage.local.set({pinnedTabId:r.id}),{pinnedTabId:r.id}}A.default.runtime.onConnect.addListener(async e=>{e.onMessage.addListener(async t=>{try{await Ms(e,t.question,t.conversationId,t.parentMessageId,t.conversationContext)}catch(r){e.postMessage({error:r.message})}})});A.default.runtime.onMessage.addListener(async e=>{if(e.type==="FEEDBACK")if((await J()).provider==="chatgpt"){let r=await me();await Ut(r,e.data)}else await It(e.data);else if(e.type==="OPEN_OPTIONS_PAGE")A.default.runtime.openOptionsPage();else{if(e.type==="GET_ACCESS_TOKEN")return me();if(e.type==="NEW_TAB")return Ns(e.data.url);if(e.type==="GO_BACK"){let t=await A.default.storage.local.get("beyondbardTabId");t.beyondbardTabId?A.default.tabs.update(t.beyondbardTabId,{active:!0}).catch(()=>{A.default.tabs.create({url:"about:newtab",active:!0})}):A.default.tabs.create({url:"about:newtab",active:!0})}}});A.default.runtime.onInstalled.addListener(async e=>{e.reason==="install"&&A.default.runtime.openOptionsPage()});A.default.tabs.onUpdated.addListener(async(e,t)=>{let r=await A.default.storage.local.get("pinnedTabId");A.default.tabs.get(e).then(o=>{var a;(a=o.url)!=null&&a.includes(L)&&t.status==="complete"&&o.id&&r.pinnedTabId===o.id&&Dt(o)})});async function $t(e){let{id:t}=e;t&&A.default.tabs.sendMessage(t,{type:"OPEN_WEB_SUMMARY",data:{}}).catch(()=>{})}Ft?A.default.browserAction.onClicked.addListener(async e=>{await $t(e)}):A.default.action.onClicked.addListener(async e=>{await $t(e)});})();
